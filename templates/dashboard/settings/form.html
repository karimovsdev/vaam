{% extends "dashboard/base.html" %}
{% load i18n_form %}

{% block title %}Site Settings{% endblock %}
{% block page_title %}Site Settings{% endblock %}

{% block breadcrumb %}
<span class="text-[#899bbd]">/</span>
<span class="text-[#899bbd]">Settings</span>
{% endblock %}

{% block content %}
{% get_languages as languages %}

<div class="max-w-5xl" x-data="{ activeTab: 'general', langTab: 'en' }">
    <div class="bg-white rounded-md" style="box-shadow:0px 0px 30px rgba(1,41,112,.05);">
        <div class="px-5 py-4 border-b border-[#e6e9f4]">
            <h5 class="text-lg font-bold text-heading font-heading">Site Settings</h5>
            <p class="text-sm text-[#899bbd] mt-0.5">Manage your website configuration</p>
        </div>

        <!-- Category Tabs -->
        <div class="flex border-b border-[#e6e9f4] px-5 gap-1 overflow-x-auto">
            <button type="button" @click="activeTab = 'general'" :class="activeTab === 'general' ? 'text-primary border-primary' : 'text-[#899bbd] border-transparent hover:text-heading'" class="px-4 py-3 text-sm font-semibold border-b-2 transition whitespace-nowrap">
                <i class="bi bi-globe text-xs mr-1.5"></i> General Info
            </button>
            <button type="button" @click="activeTab = 'contact'" :class="activeTab === 'contact' ? 'text-primary border-primary' : 'text-[#899bbd] border-transparent hover:text-heading'" class="px-4 py-3 text-sm font-semibold border-b-2 transition whitespace-nowrap">
                <i class="bi bi-telephone text-xs mr-1.5"></i> Contact Info
            </button>
            <button type="button" @click="activeTab = 'social'" :class="activeTab === 'social' ? 'text-primary border-primary' : 'text-[#899bbd] border-transparent hover:text-heading'" class="px-4 py-3 text-sm font-semibold border-b-2 transition whitespace-nowrap">
                <i class="bi bi-share text-xs mr-1.5"></i> Social Media
            </button>
            <button type="button" @click="activeTab = 'seo'" :class="activeTab === 'seo' ? 'text-primary border-primary' : 'text-[#899bbd] border-transparent hover:text-heading'" class="px-4 py-3 text-sm font-semibold border-b-2 transition whitespace-nowrap">
                <i class="bi bi-search text-xs mr-1.5"></i> SEO
            </button>
            <button type="button" @click="activeTab = 'translations'" :class="activeTab === 'translations' ? 'text-primary border-primary' : 'text-[#899bbd] border-transparent hover:text-heading'" class="px-4 py-3 text-sm font-semibold border-b-2 transition whitespace-nowrap">
                <i class="bi bi-translate text-xs mr-1.5"></i> Translations
            </button>
        </div>

        <form method="post" enctype="multipart/form-data" class="p-6">
            {% csrf_token %}

            {% if form.errors %}
            <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded text-sm">
                <div class="flex items-center gap-2 text-red-700 font-semibold mb-2">
                    <i class="bi bi-exclamation-circle-fill"></i>
                    <span>Please correct the errors below.</span>
                </div>
                <ul class="text-red-600 ml-5 list-disc">
                    {% for field in form %}
                        {% for error in field.errors %}
                        <li>{{ field.label }}: {{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                    {% for error in form.non_field_errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- General Info Tab -->
            <div x-show="activeTab === 'general'" x-transition>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    {% for field in form %}
                        {% if field.name == 'site_name_en' or field.name == 'site_description_en' or field.name == 'logo' or field.name == 'favicon' or field.name == 'footer_text' or field.name == 'copyright_text' %}
                        <div class="{% if field.name == 'footer_text' or field.name == 'copyright_text' or field.name == 'site_description_en' %}md:col-span-2{% endif %}">
                            <label class="block text-sm font-semibold text-heading mb-2 font-heading" for="{{ field.id_for_label }}">
                                {{ field.label }}
                                {% if field.field.required %}<span class="text-danger">*</span>{% endif %}
                            </label>
                            {{ field }}
                            {% if field.help_text %}<p class="text-xs text-[#899bbd] mt-1.5">{{ field.help_text }}</p>{% endif %}
                            {% if field.errors %}<p class="text-xs text-danger mt-1">{{ field.errors.0 }}</p>{% endif %}
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>

            <!-- Contact Info Tab -->
            <div x-show="activeTab === 'contact'" x-transition x-cloak>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    {% for field in form %}
                        {% if field.name == 'email' or field.name == 'email2' or field.name == 'phone' or field.name == 'phone2' or field.name == 'address_en' or field.name == 'address2_en' or field.name == 'google_maps_embed' or field.name == 'working_hours_en' or field.name == 'whatsapp' %}
                        <div class="{% if field.name == 'address_en' or field.name == 'google_maps_embed' %}md:col-span-2{% endif %}">
                            <label class="block text-sm font-semibold text-heading mb-2 font-heading" for="{{ field.id_for_label }}">
                                {{ field.label }}
                                {% if field.field.required %}<span class="text-danger">*</span>{% endif %}
                            </label>
                            {{ field }}
                            {% if field.help_text %}<p class="text-xs text-[#899bbd] mt-1.5">{{ field.help_text }}</p>{% endif %}
                            {% if field.errors %}<p class="text-xs text-danger mt-1">{{ field.errors.0 }}</p>{% endif %}
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>

            <!-- Social Media Tab -->
            <div x-show="activeTab === 'social'" x-transition x-cloak>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    {% for field in form %}
                        {% if field.name == 'instagram' or field.name == 'telegram' or field.name == 'whatsapp' or field.name == 'linkedin' or field.name == 'twitter' or field.name == 'facebook' or field.name == 'youtube' %}
                        <div>
                            <label class="block text-sm font-semibold text-heading mb-2 font-heading" for="{{ field.id_for_label }}">
                                {{ field.label }}
                                {% if field.field.required %}<span class="text-danger">*</span>{% endif %}
                            </label>
                            {{ field }}
                            {% if field.help_text %}<p class="text-xs text-[#899bbd] mt-1.5">{{ field.help_text }}</p>{% endif %}
                            {% if field.errors %}<p class="text-xs text-danger mt-1">{{ field.errors.0 }}</p>{% endif %}
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>

            <!-- SEO Tab -->
            <div x-show="activeTab === 'seo'" x-transition x-cloak>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    {% for field in form %}
                        {% if field.name == 'meta_title_en' or field.name == 'meta_description_en' or field.name == 'meta_keywords_en' or field.name == 'google_analytics_id' or field.name == 'google_tag_manager_id' %}
                        <div class="{% if field.name == 'meta_description_en' or field.name == 'meta_keywords_en' %}md:col-span-2{% endif %}">
                            <label class="block text-sm font-semibold text-heading mb-2 font-heading" for="{{ field.id_for_label }}">
                                {{ field.label }}
                                {% if field.field.required %}<span class="text-danger">*</span>{% endif %}
                            </label>
                            {{ field }}
                            {% if field.help_text %}<p class="text-xs text-[#899bbd] mt-1.5">{{ field.help_text }}</p>{% endif %}
                            {% if field.errors %}<p class="text-xs text-danger mt-1">{{ field.errors.0 }}</p>{% endif %}
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>

            <!-- Translations Tab -->
            <div x-show="activeTab === 'translations'" x-transition x-cloak>
                <div class="border border-[#e6e9f4] rounded-lg overflow-hidden">
                    <div class="flex border-b border-[#e6e9f4] bg-[#f8f9fa] px-2 gap-0.5 overflow-x-auto">
                        {% for code, name, flag in languages %}
                        {% if code != 'en' %}
                        <button type="button" @click="langTab = '{{ code }}'"
                                :class="langTab === '{{ code }}'
                                    ? 'text-primary border-primary bg-white'
                                    : 'text-[#899bbd] border-transparent hover:text-heading hover:bg-white/60'"
                                class="flex items-center gap-1.5 px-4 py-3 text-sm font-semibold border-b-2 transition whitespace-nowrap rounded-t -mb-px">
                            <span>{{ flag }}</span>
                            <span>{{ name }}</span>
                        </button>
                        {% endif %}
                        {% endfor %}
                    </div>

                    {% for code, name, flag in languages %}
                    {% if code != 'en' %}
                    <div x-show="langTab === '{{ code }}'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-cloak class="p-5">
                        <div class="flex items-center gap-2 mb-4">
                            <span class="text-lg">{{ flag }}</span>
                            <h6 class="text-sm font-bold text-heading font-heading">{{ name }} Translation</h6>
                            <span class="text-[10px] text-[#899bbd] bg-[#f6f9ff] px-2 py-0.5 rounded-full ml-auto">Leave empty to use English value</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            {% for field in form %}
                                {% if field.name|is_translation_field and field.name|field_lang == code %}
                                <div class="{% if field|is_wide_field %}md:col-span-2{% endif %}">
                                    <label class="block text-sm font-semibold text-heading mb-2 font-heading" for="{{ field.id_for_label }}">
                                        {{ field.name|field_base_name|title }}
                                    </label>
                                    {{ field }}
                                    {% if field.errors %}<p class="text-xs text-danger mt-1">{{ field.errors.0 }}</p>{% endif %}
                                </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>

            <div class="flex items-center justify-end mt-8 pt-5 border-t border-[#e6e9f4]">
                <button type="submit" class="px-6 py-2.5 rounded bg-primary text-white text-sm font-semibold hover:bg-primary-dark transition-all duration-200">
                    <i class="bi bi-save mr-1.5"></i> Save Settings
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
